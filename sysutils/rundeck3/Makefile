# $FreeBSD$

PORTNAME=	rundeck
DISTVERSION=	3.3.3
DISTVERSIONSUFFIX=	20200910
CATEGORIES=	sysutils java
MASTER_SITES=	https://download.rundeck.org/war/
PKGNAMESUFFIX=	3
DISTNAME=	${PORTNAME}-${DISTVERSION}-${DISTVERSIONSUFFIX}
EXTRACT_SUFX=	.war

MAINTAINER=	daniel.tihanyi@tetragir.com
COMMENT=	Web-console for dispatching commands and scripts to your nodes

LICENSE=	APACHE20

USE_JAVA=	yes
JAVA_VERSION=	1.8+

CONFLICTS_INSTALL=	rundeck2

NO_ARCH=	yes
NO_BUILD=	yes

PLIST_SUB=	RUNDECK_USER=${RUNDECK_USER} RUNDECK_GROUP=${RUNDECK_GROUP}
USE_RC_SUBR=	rundeck

RUNDECK_HOME=	${PREFIX}/rundeck
RUNDECK_USER?=	rundeck
RUNDECK_GROUP?=	rundeck
RUNDECK_LOG_FILE?=	/var/log/rundeck.log

.if ${RUNDECK_USER} == "rundeck"
USERS=	rundeck
.endif
.if ${RUNDECK_GROUP} == "rundeck"
GROUPS=	rundeck
.endif

SUB_LIST+=	RUNDECK_HOME=${RUNDECK_HOME} RUNDECK_USER=${RUNDECK_USER} \
		RUNDECK_GROUP=${RUNDECK_GROUP} JAVA_HOME=${JAVA_HOME} \
		RUNDECK_LOG_FILE=${RUNDECK_LOG_FILE}

do-install:
	@${MKDIR} ${STAGEDIR}${DATADIR} ${STAGEDIR}${RUNDECK_HOME}/server/lib
	${INSTALL_DATA} ${DISTDIR}/${DIST_SUBDIR}/${DISTNAME}${EXTRACT_SUFX} \
		${STAGEDIR}${DATADIR}/rundeck${EXTRACT_SUFX}

.include <bsd.port.mk>
