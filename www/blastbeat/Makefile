# Created by: Veniamin Gvozdikov <vg@FreeBSD.org>
# $FreeBSD$

PORTNAME=	blastbeat
PORTVERSION=	20121205
PORTREVISION=	3
CATEGORIES=	www

MAINTAINER=	ports@FreeBSD.org
COMMENT=	High-performance HTTP/HTTPS/SPDY proxy

LICENSE=	UNBIT
LICENSE_NAME=	UNBIT
LICENSE_FILE=	${WRKSRC}/LICENSE
LICENSE_PERMS=	auto-accept

LIB_DEPENDS=	libev.so:devel/libev \
		libuuid.so:misc/e2fsprogs-libuuid \
		libzmq.so:net/libzmq2

USES=		gmake ssl
USE_GITHUB=	yes
GH_ACCOUNT=	zloidemon
GH_TAGNAME=	cdac9a9
PORTEXAMPLES=	*

CFLAGS+=	-I${LOCALBASE}/include
LIBS+=		-L${LOCALBASE}/lib -lm

PLIST_FILES=	bin/blastbeat \
		%%ETCDIR%%/blastbeat.ini.sample

OPTIONS_DEFINE=	EXAMPLES

.include <bsd.port.options.mk>

.if ${SSL_DEFAULT} == base
BROKEN_FreeBSD_12=	incomplete definition of type 'struct ssl_st'
BROKEN_FreeBSD_13=	incomplete definition of type 'struct ssl_st'
.endif

do-install:
	${INSTALL_PROGRAM} ${WRKSRC}/${PORTNAME} ${STAGEDIR}${PREFIX}/bin
	${MKDIR} ${STAGEDIR}${ETCDIR} && \
		${INSTALL} ${WRKSRC}/${PORTNAME}.ini ${STAGEDIR}${ETCDIR}/${PORTNAME}.ini.sample
.if ${PORT_OPTIONS:MEXAMPLES}
	${MKDIR} ${STAGEDIR}${EXAMPLESDIR}
	@cd ${WRKSRC}/examples && ${COPYTREE_SHARE} . ${STAGEDIR}${EXAMPLESDIR}
.endif

.include <bsd.port.mk>
